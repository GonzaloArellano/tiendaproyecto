{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mundo Cartas{% endblock %}</title>
    
    <!-- Estilos CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    <!-- Estilos adicionales por pÃ¡gina -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container">
        <!-- Header Bar CON BOTONES DE LOGIN/LOGOUT -->
        <div class="header-bar">
            <div class="header-title">ğŸƒ MUNDO CARTAS - {% block page_header %}Sistema de GestiÃ³n{% endblock %}</div>
            <div class="header-info">
                {% if user.is_authenticated %}
                    ğŸ‘¤ {{ user.username }} ({{ user.perfilusuario.rol.nombre }}) | 
                    <a href="{% url 'registration:logout' %}" style="color: white; text-decoration: none; font-weight: 600;">ğŸšª Salir</a>
                {% else %}
                    <a href="{% url 'registration:login' %}" style="color: white; text-decoration: none; font-weight: 600;">ğŸ” Iniciar SesiÃ³n</a> | 
                    <a href="{% url 'registration:registro' %}" style="color: white; text-decoration: none; font-weight: 600;">ğŸ“ Registrarse</a>
                {% endif %}
                 | Fecha: {% now "d/m/Y" %} | Hora: {% now "H:i" %}
            </div>
        </div>
        
        <!-- Toolbar -->
        <div class="toolbar">
            {% block toolbar %}
            
            {% if user.is_authenticated %}
                {% if user.perfilusuario.rol.nombre == 'Administrador' %}
                    <!-- Toolbar para ADMINISTRADOR -->
                    <a href="{% url 'inventario:lista_productos' %}" class="toolbar-btn {% if 'inventario' in request.path and 'pos' not in request.path and 'ventas' not in request.path %}active{% endif %}">ğŸ“‹ Inventario</a>
                    <a href="{% url 'inventario:pos' %}" class="toolbar-btn {% if 'pos' in request.path %}active{% endif %}">ğŸ’³ POS</a>
                    <a href="{% url 'inventario:lista_ventas' %}" class="toolbar-btn {% if 'ventas' in request.path %}active{% endif %}">ğŸ“Š Ventas</a>
                    <a href="{% url 'inventario:importar_productos' %}" class="toolbar-btn {% if 'importar' in request.path %}active{% endif %}">ğŸ“¥ Importar</a>
                    <a href="{% url 'registration:lista_vendedores' %}" class="toolbar-btn {% if 'vendedores' in request.path %}active{% endif %}">ğŸ‘¥ Vendedores</a>
                    <a href="{% url 'admin:index' %}" class="toolbar-btn">âš™ï¸ Admin</a>
                    <a href="{% url 'registration:perfil' %}" class="toolbar-btn {% if request.path == '/accounts/perfil/' %}active{% endif %}">ğŸ‘¤ Mi Perfil</a>
                    
                {% elif user.perfilusuario.rol.nombre == 'Vendedor' %}
                    <!-- Toolbar para VENDEDOR -->
                    <a href="{% url 'inventario:lista_productos' %}" class="toolbar-btn {% if 'inventario' in request.path and 'pos' not in request.path and 'ventas' not in request.path %}active{% endif %}">ğŸ“‹ Inventario</a>
                    <a href="{% url 'inventario:pos' %}" class="toolbar-btn {% if 'pos' in request.path %}active{% endif %}">ğŸ’³ POS</a>
                    <a href="{% url 'inventario:lista_ventas' %}" class="toolbar-btn {% if 'ventas' in request.path %}active{% endif %}">ğŸ“Š Mis Ventas</a>
                    <a href="{% url 'inventario:importar_productos' %}" class="toolbar-btn {% if 'importar' in request.path %}active{% endif %}">ğŸ“¥ Importar</a>
                    <a href="{% url 'registration:perfil' %}" class="toolbar-btn {% if request.path == '/accounts/perfil/' %}active{% endif %}">ğŸ‘¤ Mi Perfil</a>
                    
                {% else %}
                    <!-- Toolbar para CLIENTE -->
                    <a href="{% url 'carrito:catalogo' %}" class="toolbar-btn {% if request.resolver_match.url_name == 'catalogo' %}active{% endif %}">ğŸ  CatÃ¡logo</a>
                    <a href="{% url 'carrito:ver_carrito' %}" class="toolbar-btn {% if 'carrito' in request.path and request.resolver_match.url_name != 'catalogo' %}active{% endif %}">
                        ğŸ›’ Mi Carrito
                        {% if user.carrito.cantidad_items > 0 %}
                            <span style="background: #dc3545; color: white; border-radius: 10px; padding: 2px 8px; font-size: 11px; margin-left: 5px;">
                                {{ user.carrito.cantidad_items }}
                            </span>
                        {% endif %}
                    </a>
                    <a href="{% url 'registration:perfil' %}" class="toolbar-btn {% if request.path == '/accounts/perfil/' %}active{% endif %}">ğŸ‘¤ Mi Perfil</a>
                {% endif %}
            {% else %}
                <!-- Toolbar para NO AUTENTICADO -->
                <a href="{% url 'carrito:catalogo' %}" class="toolbar-btn {% if request.resolver_match.url_name == 'catalogo' %}active{% endif %}">ğŸ  CatÃ¡logo</a>
            {% endif %}
            
            {% endblock %}
        </div>

        <!-- Messages -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Main Content -->
        {% block content %}
        {% endblock %}
    </div>

    <!-- JavaScript -->
    <script>
        {% block extra_js %}{% endblock %}
    </script>
</body>
</html>